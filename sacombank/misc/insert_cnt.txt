INSERT INTO POS_TERMINAL_6M_TEST 
select E.customer_cde,
    F.MERCHANT_CDE, F.TERMINAL_ID
    ,TO_DATE('{RPT_DT}','DD-MM-YY') AS RPT_DT, CT_TXN_TERMINAL ,CURRENT_TIMESTAMP ADD_TSTP  
FROM
(
select customer_cde, MERCHANT_CDE, TERMINAL_ID ,  ct_txn_terminal FROM
(
select customer_cde, merchant_cde, TERMINAL_ID,
       count(*) ct_txn_terminal, row_number()over(partition by customer_cde order by count(*) desc) rn1
from
(
select customer_cde, merchant_cde,cardhdr_no, TERMINAL_ID,
        approval_cde, retrvl_refno,
        process_dt, 
        row_number()over(partition by customer_cde,cardhdr_no, approval_cde, retrvl_refno order by process_dt desc) rn

from 
(
 select customer_cde, trim(' ' from(merchant_cde)) merchant_cde, cardhdr_no, TERMINAL_ID,
        trim(' ' from (approval_cde)) approval_cde, retrvl_refno,
        process_dt
        from DW_ANALYTICS.dw_card_transaction_fct T1
        where process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
        and tran_status = 'S' 
        and  exists (select 1 from CINS_TMP_CUST_TEST t2 where t1.CUSTOMER_CDE=t2.CUSTOMER_CDE) 
 )    
         )
where rn = 1
group by customer_cde, merchant_cde, terminal_id
             )
where rn1 = 1
) E
LEFT JOIN
(
SELECT MERCHANT_CDE, TERMINAL_ID, TERMINAL_TYPE FROM DW_ANALYTICS.DW_CARD_TERMINAL_DIM 
WHERE TERMINAL_TYPE = 'POS'
) F
ON E.MERCHANT_CDE = F.MERCHANT_CDE AND E.TERMINAL_ID = F.TERMINAL_ID
WHERE F.MERCHANT_CDE IS NOT NULL;



INSERT INTO POS_MERCHANT_6M_TEST
select E.customer_cde, F.MERCHANT_ID  , NULL TERMINAL_ID,TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, ct_txn_pos,CURRENT_TIMESTAMP ADD_TSTP  
FROM
(
select customer_cde, MERCHANT_CDE,  ct_txn_pos FROM
(
select customer_cde, merchant_cde,
       count(*) ct_txn_pos, row_number()over(partition by customer_cde order by count(*) desc) rn1
from
(
select customer_cde, merchant_cde,cardhdr_no,
        approval_cde, retrvl_refno,
        process_dt, 
        row_number()over(partition by customer_cde,cardhdr_no, approval_cde, retrvl_refno order by process_dt desc) rn

from 
(
 select customer_cde, trim(' ' from(merchant_cde)) merchant_cde, cardhdr_no,
        trim(' ' from (approval_cde)) approval_cde, retrvl_refno,
        process_dt
        from DW_ANALYTICS.dw_card_transaction_fct T1
        where process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
        and tran_status = 'S' 
        and  exists (select 1 from CINS_TMP_CUST_TEST t2 where t1.CUSTOMER_CDE=t2.CUSTOMER_CDE) 
 )    
         )
where rn = 1
group by customer_cde, merchant_cde
             )
where rn1 = 1
) E
JOIN
(SELECT MERCHANT_ID
FROM DW_ANALYTICS.DW_CARD_MERCHANT_DIM) F
ON E.MERCHANT_CDE = F.MERCHANT_ID
WHERE E.MERCHANT_CDE IS NOT NULL;









INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE, 'FAV_POS_6M_CT' FTR_NM,  MERCHANT_CDE ||'-'||terminal_id FTR_VAL,TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, CURRENT_TIMESTAMP ADD_TSTP  FROM
(
SELECT CUSTOMER_CDE, MERCHANT_CDE, TERMINAL_ID, RPT_DT, CT_TXN_TERMINAL, ADD_TSTP,
ROW_NUMBER()OVER(PARTITION BY CUSTOMER_CDE ORDER BY CT_TXN_TERMINAL DESC) RN1
FROM (
(
SELECT * FROM POS_MERCHANT_6M_TEST WHERE to_date(RPT_DT) = to_date('{RPT_DT}','DD-MM-YY')
)
UNION  ALL
(
SELECT * FROM POS_TERMINAL_6M_TEST WHERE to_date(RPT_DT) = to_date('{RPT_DT}','DD-MM-YY')
)
    )
 ) WHERE RN1 = 1; 








INSERT INTO POS_TERMINAL_AMT_6M_TEST 
select E.customer_cde,
    F.MERCHANT_CDE, F.TERMINAL_ID
    ,TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, AMT_BILL ,CURRENT_TIMESTAMP ADD_TSTP  
FROM
(
select customer_cde, MERCHANT_CDE, TERMINAL_ID ,  AMT_BILL FROM
(
select customer_cde, merchant_cde, TERMINAL_ID,
       SUM(AMT_BILL) AMT_BILL, row_number()over(partition by customer_cde order by SUM(AMT_BILL) desc) rn1
from
(
select customer_cde, merchant_cde,cardhdr_no, TERMINAL_ID,
        approval_cde, retrvl_refno,
        process_dt, AMT_BILL,
        row_number()over(partition by customer_cde,cardhdr_no, approval_cde, retrvl_refno order by process_dt desc) rn

from 
(
 select customer_cde, trim(' ' from(merchant_cde)) merchant_cde, cardhdr_no, TERMINAL_ID,
        trim(' ' from (approval_cde)) approval_cde, retrvl_refno,ABS(AMT_BILL) AMT_BILL,
        process_dt
        from DW_ANALYTICS.dw_card_transaction_fct T1
        where process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
        and tran_status = 'S' 
        and  exists (select 1 from CINS_TMP_CUST_TEST t2 where t1.CUSTOMER_CDE=t2.CUSTOMER_CDE) 
 )    
         )
where rn = 1
group by customer_cde, merchant_cde, terminal_id
             )
where rn1 = 1
) E
LEFT JOIN
(
SELECT MERCHANT_CDE, TERMINAL_ID, TERMINAL_TYPE FROM DW_ANALYTICS.DW_CARD_TERMINAL_DIM 
WHERE TERMINAL_TYPE = 'POS'
) F
ON E.MERCHANT_CDE = F.MERCHANT_CDE AND E.TERMINAL_ID = F.TERMINAL_ID
WHERE F.MERCHANT_CDE IS NOT NULL;




INSERT INTO POS_MERCHANT_AMT_6M_TEST 
select E.customer_cde, F.MERCHANT_ID  , NULL TERMINAL_ID,TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, AMT_BILL,CURRENT_TIMESTAMP ADD_TSTP  
FROM
(
select customer_cde, MERCHANT_CDE,  AMT_BILL FROM
(
select customer_cde, merchant_cde,
       SUM(AMT_BILL) AMT_BILL, row_number()over(partition by customer_cde order by SUM(AMT_BILL) desc) rn1
from
(
select customer_cde, merchant_cde,cardhdr_no,
        approval_cde, retrvl_refno,
        process_dt, 
        AMT_BILL,
        row_number()over(partition by customer_cde,cardhdr_no, approval_cde, retrvl_refno order by process_dt desc) rn

from 
(
 select customer_cde, trim(' ' from(merchant_cde)) merchant_cde, cardhdr_no,
        trim(' ' from (approval_cde)) approval_cde, retrvl_refno,ABS(AMT_BILL) AMT_BILL,
        process_dt
        from DW_ANALYTICS.dw_card_transaction_fct T1
        where process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
        and tran_status = 'S' 
        and  exists (select 1 from CINS_TMP_CUST_TEST t2 where t1.CUSTOMER_CDE=t2.CUSTOMER_CDE) 
 )    
         )
where rn = 1
group by customer_cde, merchant_cde
             )
where rn1 = 1
) E
JOIN
(SELECT MERCHANT_ID
FROM DW_ANALYTICS.DW_CARD_MERCHANT_DIM) F
ON E.MERCHANT_CDE = F.MERCHANT_ID
WHERE E.MERCHANT_CDE IS NOT NULL;










INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE, 'FAV_POS_6M_SM' FTR_NM,  MERCHANT_CDE ||'-'||terminal_id FTR_VAL,TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, CURRENT_TIMESTAMP ADD_TSTP  FROM
(
SELECT CUSTOMER_CDE, MERCHANT_CDE, TERMINAL_ID, RPT_DT, AMT_BILL, ADD_TSTP,
ROW_NUMBER()OVER(PARTITION BY CUSTOMER_CDE ORDER BY AMT_BILL DESC) RN1
FROM
(

(
SELECT * FROM POS_TERMINAL_AMT_6M_TEST
WHERE to_date(RPT_DT) = to_date('{RPT_DT}','DD-MM-YY'))
UNION  ALL
(
SELECT * FROM POS_MERCHANT_AMT_6M_TEST
WHERE to_date(RPT_DT) = to_date('{RPT_DT}','DD-MM-YY'))

 ) 
 ) WHERE RN1 = 1;












INSERT INTO {TBL_NM}
select customer_cde, 'CARD_TOP1_MERCHANT_6M' FTR_NM, merchant_cde FTR_VAL , TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,CURRENT_TIMESTAMP ADD_TSTP from 
(
select customer_cde, merchant_cde, 
       count(*) ct_txn_merchant, row_number()over(partition by customer_cde order by count(*) desc) rn1
from
(
select customer_cde, merchant_cde,cardhdr_no, 
        approval_cde, retrvl_refno,
        process_dt, 
        row_number()over(partition by customer_cde,cardhdr_no, approval_cde, retrvl_refno order by process_dt desc) rn from 
(
 select customer_cde, trim(' ' from(merchant_cde)) merchant_cde,cardhdr_no, 
        trim(' ' from (approval_cde)) approval_cde, retrvl_refno,
        process_dt
        from DW_ANALYTICS.dw_card_transaction_fct
        where process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
        and tran_status = 'S' 
        and  CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
 ))
where rn = 1
group by customer_cde, merchant_cde)
where rn1 = 1;






INSERT INTO {TBL_NM}
select customer_cde, 'CARD_TOP2_MERCHANT_6M' FTR_NM, merchant_cde FTR_VAL , TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,CURRENT_TIMESTAMP ADD_TSTP from 
(
select customer_cde, merchant_cde, 
       count(*) ct_txn_merchant, row_number()over(partition by customer_cde order by count(*) desc) rn1
from
(
select customer_cde, merchant_cde,cardhdr_no, 
        approval_cde, retrvl_refno,
        process_dt, 
        row_number()over(partition by customer_cde,cardhdr_no, approval_cde, retrvl_refno order by process_dt desc) rn from 
(
 select customer_cde, trim(' ' from(merchant_cde)) merchant_cde,cardhdr_no, 
        trim(' ' from (approval_cde)) approval_cde, retrvl_refno,
        process_dt
        from DW_ANALYTICS.dw_card_transaction_fct
        where process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
        and tran_status = 'S' 
        and  CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
 ))
where rn = 1
group by customer_cde, merchant_cde)
where rn1 = 2;






INSERT INTO {TBL_NM}
select customer_cde, 'CARD_TOP3_MERCHANT_6M' FTR_NM, merchant_cde FTR_VAL , TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,CURRENT_TIMESTAMP ADD_TSTP from 
(
select customer_cde, merchant_cde, 
       count(*) ct_txn_merchant, row_number()over(partition by customer_cde order by count(*) desc) rn1
from
(
select customer_cde, merchant_cde,cardhdr_no, 
        approval_cde, retrvl_refno,
        process_dt, 
        row_number()over(partition by customer_cde,cardhdr_no, approval_cde, retrvl_refno order by process_dt desc) rn from 
(
 select customer_cde, trim(' ' from(merchant_cde)) merchant_cde,cardhdr_no, 
        trim(' ' from (approval_cde)) approval_cde, retrvl_refno,
        process_dt
        from DW_ANALYTICS.dw_card_transaction_fct
        where process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
        and tran_status = 'S' 
        and  CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
 ))
where rn = 1
group by customer_cde, merchant_cde)
where rn1 = 3;





INSERT INTO {TBL_NM}
select customer_cde, 'CARD_TOP4_MERCHANT_6M' FTR_NM, merchant_cde FTR_VAL , TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,CURRENT_TIMESTAMP ADD_TSTP from 
(
select customer_cde, merchant_cde, 
       count(*) ct_txn_merchant, row_number()over(partition by customer_cde order by count(*) desc) rn1
from
(
select customer_cde, merchant_cde,cardhdr_no, 
        approval_cde, retrvl_refno,
        process_dt, 
        row_number()over(partition by customer_cde,cardhdr_no, approval_cde, retrvl_refno order by process_dt desc) rn from 
(
 select customer_cde, trim(' ' from(merchant_cde)) merchant_cde,cardhdr_no, 
        trim(' ' from (approval_cde)) approval_cde, retrvl_refno,
        process_dt
        from DW_ANALYTICS.dw_card_transaction_fct
        where process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
        and tran_status = 'S' 
        and  CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
 ))
where rn = 1
group by customer_cde, merchant_cde)
where rn1 = 4;





INSERT INTO {TBL_NM}
select customer_cde, 'CARD_TOP5_MERCHANT_6M' FTR_NM, merchant_cde FTR_VAL , TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,CURRENT_TIMESTAMP ADD_TSTP from 
(
select customer_cde, merchant_cde, 
       count(*) ct_txn_merchant, row_number()over(partition by customer_cde order by count(*) desc) rn1
from
(
select customer_cde, merchant_cde,cardhdr_no, 
        approval_cde, retrvl_refno,
        process_dt, 
        row_number()over(partition by customer_cde,cardhdr_no, approval_cde, retrvl_refno order by process_dt desc) rn from 
(
 select customer_cde, trim(' ' from(merchant_cde)) merchant_cde,cardhdr_no, 
        trim(' ' from (approval_cde)) approval_cde, retrvl_refno,
        process_dt
        from DW_ANALYTICS.dw_card_transaction_fct
        where process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
        and tran_status = 'S' 
        and  CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
 ))
where rn = 1
group by customer_cde, merchant_cde)
where rn1 = 5;





INSERT INTO {TBL_NM}
select customer_cde, 'CARD_TOP6_MERCHANT_6M' FTR_NM, merchant_cde FTR_VAL , TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,CURRENT_TIMESTAMP ADD_TSTP from 
(
select customer_cde, merchant_cde, 
       count(*) ct_txn_merchant, row_number()over(partition by customer_cde order by count(*) desc) rn1
from
(
select customer_cde, merchant_cde,cardhdr_no, 
        approval_cde, retrvl_refno,
        process_dt, 
        row_number()over(partition by customer_cde,cardhdr_no, approval_cde, retrvl_refno order by process_dt desc) rn from 
(
 select customer_cde, trim(' ' from(merchant_cde)) merchant_cde,cardhdr_no, 
        trim(' ' from (approval_cde)) approval_cde, retrvl_refno,
        process_dt
        from DW_ANALYTICS.dw_card_transaction_fct
        where process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
        and tran_status = 'S' 
        and  CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
 ))
where rn = 1
group by customer_cde, merchant_cde)
where rn1 = 6;





INSERT INTO {TBL_NM}
select customer_cde, 'CARD_TOP7_MERCHANT_6M' FTR_NM, merchant_cde FTR_VAL , TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,CURRENT_TIMESTAMP ADD_TSTP from 
(
select customer_cde, merchant_cde, 
       count(*) ct_txn_merchant, row_number()over(partition by customer_cde order by count(*) desc) rn1
from
(
select customer_cde, merchant_cde,cardhdr_no, 
        approval_cde, retrvl_refno,
        process_dt, 
        row_number()over(partition by customer_cde,cardhdr_no, approval_cde, retrvl_refno order by process_dt desc) rn from 
(
 select customer_cde, trim(' ' from(merchant_cde)) merchant_cde,cardhdr_no, 
        trim(' ' from (approval_cde)) approval_cde, retrvl_refno,
        process_dt
        from DW_ANALYTICS.dw_card_transaction_fct
        where process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
        and tran_status = 'S' 
        and  CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
 ))
where rn = 1
group by customer_cde, merchant_cde)
where rn1 = 7;





INSERT INTO {TBL_NM}
select customer_cde, 'CARD_TOP8_MERCHANT_6M' FTR_NM, merchant_cde FTR_VAL , TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,CURRENT_TIMESTAMP ADD_TSTP from 
(
select customer_cde, merchant_cde, 
       count(*) ct_txn_merchant, row_number()over(partition by customer_cde order by count(*) desc) rn1
from
(
select customer_cde, merchant_cde,cardhdr_no, 
        approval_cde, retrvl_refno,
        process_dt, 
        row_number()over(partition by customer_cde,cardhdr_no, approval_cde, retrvl_refno order by process_dt desc) rn from 
(
 select customer_cde, trim(' ' from(merchant_cde)) merchant_cde,cardhdr_no, 
        trim(' ' from (approval_cde)) approval_cde, retrvl_refno,
        process_dt
        from DW_ANALYTICS.dw_card_transaction_fct
        where process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
        and tran_status = 'S' 
        and  CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
 ))
where rn = 1
group by customer_cde, merchant_cde)
where rn1 = 8;





INSERT INTO {TBL_NM}
select customer_cde, 'CARD_TOP9_MERCHANT_6M' FTR_NM, merchant_cde FTR_VAL , TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,CURRENT_TIMESTAMP ADD_TSTP from 
(
select customer_cde, merchant_cde, 
       count(*) ct_txn_merchant, row_number()over(partition by customer_cde order by count(*) desc) rn1
from
(
select customer_cde, merchant_cde,cardhdr_no, 
        approval_cde, retrvl_refno,
        process_dt, 
        row_number()over(partition by customer_cde,cardhdr_no, approval_cde, retrvl_refno order by process_dt desc) rn from 
(
 select customer_cde, trim(' ' from(merchant_cde)) merchant_cde,cardhdr_no, 
        trim(' ' from (approval_cde)) approval_cde, retrvl_refno,
        process_dt
        from DW_ANALYTICS.dw_card_transaction_fct
        where process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
        and tran_status = 'S' 
        and  CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
 ))
where rn = 1
group by customer_cde, merchant_cde)
where rn1 = 9;





INSERT INTO {TBL_NM}
select customer_cde, 'CARD_TOP10_MERCHANT_6M' FTR_NM, merchant_cde FTR_VAL , TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,CURRENT_TIMESTAMP ADD_TSTP from 
(
select customer_cde, merchant_cde, 
       count(*) ct_txn_merchant, row_number()over(partition by customer_cde order by count(*) desc) rn1
from
(
select customer_cde, merchant_cde,cardhdr_no, 
        approval_cde, retrvl_refno,
        process_dt, 
        row_number()over(partition by customer_cde,cardhdr_no, approval_cde, retrvl_refno order by process_dt desc) rn from 
(
 select customer_cde, trim(' ' from(merchant_cde)) merchant_cde,cardhdr_no, 
        trim(' ' from (approval_cde)) approval_cde, retrvl_refno,
        process_dt
        from DW_ANALYTICS.dw_card_transaction_fct
        where process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
        and tran_status = 'S' 
        and  CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
 ))
where rn = 1
group by customer_cde, merchant_cde)
where rn1 = 10;





INSERT INTO {TBL_NM}
select customer_cde,'CARD_CT_VAR_BRANCH_3M' FTR_NM, count(distinct sub_branch_cde) FTR_VAL, TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,CURRENT_TIMESTAMP ADD_TSTP  from 
( 
    select customer_cde, sub_branch_cde, process_dt from DW_ANALYTICS.DW_CARD_TRANSACTION_FCT 
    where tran_status = 'S' 
    AND CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
    )
where process_dt < TO_DATE('{RPT_DT}','DD-MM-YY')
AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -3)
group by customer_cde;
 

INSERT INTO {TBL_NM}
SELECT  customer_cde, 'CARD_BRANCH_LOC_3M' FTR_NM, sub_Branch_cde FTR_VAL, TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, CURRENT_TIMESTAMP ADD_TSTP    from
(
    SELECT customer_cde,sub_branch_cde,
    max(process_dt), ROW_NUMBER()OVER(PARTITION BY CUSTOMER_CDE ORDER BY max(process_dt) DESC) RN
    FROM  DW_ANALYTICS.DW_CARD_TRANSACTION_FCT 
    WHERE tran_status = 'S'
    AND CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
    AND process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -3)
    GROUP BY customer_cde,sub_branch_cde
)
WHERE RN = 1;
 
INSERT INTO {TBL_NM}
select customer_cde, 'CASA_CT_VAR_BRANCH_REG_3M' FTR_NM, count(distinct sub_branch_cde) FTR_VAL, TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, CURRENT_TIMESTAMP ADD_TSTP
from
(select customer_cde, acct_id, sub_branch_cde , row_number()over(partition by customer_cde,acct_id order by update_dt desc) rn
from  DW_ANALYTICS.dw_account_master_dim
where CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
and open_dt < TO_DATE('{RPT_DT}','DD-MM-YY') and active = 1 AND open_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -3)
and company_key = 1 and active = 1 and category_cde like '10__'
)
where rn = 1  
group by customer_cde;
 

INSERT INTO {TBL_NM}
select customer_cde,'CARD_CT_VAR_BRANCH_REG_3M' FTR_NM, count(distinct sub_branch_cde)FTR_VAL,TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,CURRENT_TIMESTAMP ADD_TSTP
from DW_ANALYTICS.dw_card_master_dim
where anniv_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND anniv_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -3)
and CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
group by customer_cde;
 
INSERT INTO {TBL_NM}
SELECT  customer_cde, 'CARD_BRANCH_LOC_6M' FTR_NM, sub_Branch_cde FTR_VAL, TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, CURRENT_TIMESTAMP ADD_TSTP    from
(
    SELECT customer_cde,sub_branch_cde,
    max(process_dt), ROW_NUMBER()OVER(PARTITION BY CUSTOMER_CDE ORDER BY max(process_dt) DESC) RN
    FROM  DW_ANALYTICS.DW_CARD_TRANSACTION_FCT 
    WHERE tran_status = 'S'
    AND CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
    AND process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
    GROUP BY customer_cde,sub_branch_cde
)
WHERE RN = 1;
 
INSERT INTO {TBL_NM}
SELECT customer_cde,'EB_CT_TXN_3M' FTR_NM ,count(DISTINCT txn_id) FTR_VAL, TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,CURRENT_TIMESTAMP ADD_TSTP 
FROM (select customer_cde, txn_id , txn_dt from DW_ANALYTICS.dw_eb_transaction_fct
    where CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
    AND TXN_ENTRY_STATUS = 'SUC' )
where TXN_DT < TO_DATE('{RPT_DT}','DD-MM-YY') AND TXN_DT >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -3)
group by customer_cde;
 
INSERT INTO {TBL_NM}
SELECT customer_cde,'EB_CT_TXN_6M' FTR_NM ,count(DISTINCT txn_id) FTR_VAL, TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,CURRENT_TIMESTAMP ADD_TSTP
FROM (select customer_cde, txn_id , txn_dt from DW_ANALYTICS.dw_eb_transaction_fct
    where CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
    AND TXN_ENTRY_STATUS = 'SUC' )
where TXN_DT < TO_DATE('{RPT_DT}','DD-MM-YY') AND TXN_DT >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
group by customer_cde;
 
INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,'CARD_SUM_TXN_AMT_3M' FTR_NM,SUM(ABS(AMT_BILL)) FTR_VAL, TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,CURRENT_TIMESTAMP ADD_TSTP from  
(
select customer_cde,cardhdr_no, approval_cde, retrvl_refno, process_dt, amt_bill,
row_number()over(partition by customer_cde,cardhdr_no, approval_cde, retrvl_refno, amt_bill order by process_dt desc) rn
FROM (
select customer_cde,cardhdr_no,  TRIM(' ' FROM (approval_cde)) approval_cde, retrvl_refno, amt_bill, process_dt
      from DW_ANALYTICS.DW_CARD_TRANSACTION_FCT
      where CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
    and tran_status = 'S'
    and process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -3)
    group by customer_cde,cardhdr_no,  TRIM(' ' FROM (approval_cde)), retrvl_refno, amt_bill, process_dt
    )
)
where rn = 1
GROUP BY CUSTOMER_CDE;
 
INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,'CARD_SUM_TXN_AMT_6M' FTR_NM,SUM(ABS(AMT_BILL)) FTR_VAL, TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,CURRENT_TIMESTAMP ADD_TSTP   from  
(
select customer_cde,cardhdr_no, approval_cde, retrvl_refno, process_dt, amt_bill,
row_number()over(partition by customer_cde,cardhdr_no, approval_cde, retrvl_refno, amt_bill order by process_dt desc) rn
FROM (
select customer_cde,cardhdr_no,  TRIM(' ' FROM (approval_cde)) approval_cde, retrvl_refno, amt_bill, process_dt
      from DW_ANALYTICS.DW_CARD_TRANSACTION_FCT
      where CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
    and tran_status = 'S'
    and process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
    group by customer_cde,cardhdr_no,  TRIM(' ' FROM (approval_cde)), retrvl_refno, amt_bill, process_dt
    )
)
where rn = 1
GROUP BY CUSTOMER_CDE;
 
INSERT INTO {TBL_NM}
select customer_cde,'LOR' FTR_NM,
EXTRACT(DAY FROM TO_DATE('{RPT_DT}','DD-MM-YY') - TO_DATE(CUS_OPEN_DT)) FTR_VAL, TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, CURRENT_TIMESTAMP ADD_TSTP
from DW_ANALYTICS.dw_customer_dim
WHERE  SUB_SECTOR_CDE IN ('1700','1602') AND ACTIVE = '1' AND COMPANY_KEY = '1' AND TO_DATE(CUS_OPEN_DT) <= TO_DATE('{RPT_DT}','DD-MM-YY') ;
 
INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE, 'CARD_AVG_BAL_3M' FTR_NM,AVG(ABS(TT_ORIGINAL_BALANCE)) FTR_VAL,TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,CURRENT_TIMESTAMP ADD_TSTP
FROM DW_ANALYTICS.DATA_RPT_CARD_493
WHERE  CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
AND process_dt < TO_DATE('{RPT_DT}','DD-MM-YY')  
AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -3)
GROUP BY CUSTOMER_CDE;
 
INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE, 'CARD_AVG_BAL_6M' FTR_NM,AVG(ABS(TT_ORIGINAL_BALANCE)) FTR_VAL,TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,CURRENT_TIMESTAMP ADD_TSTP
FROM DW_ANALYTICS.DATA_RPT_CARD_493
WHERE  CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
AND process_dt < TO_DATE('{RPT_DT}','DD-MM-YY')  
AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
GROUP BY CUSTOMER_CDE;
 
INSERT INTO {TBL_NM}
select customer_cde, 'CARD_CREDIT_DEBT_GRP_6M' FTR_NM, max(tt_loan_group) FTR_VAL,TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, CURRENT_TIMESTAMP ADD_TSTP
from (select customer_cde, tt_loan_group, process_dt from DW_ANALYTICS.DATA_RPT_CARD_493
      where CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
     AND CARD_CDE LIKE '3%'
     )
where process_dt < TO_DATE('{RPT_DT}','DD-MM-YY')  
AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
group by customer_cde;
 
INSERT INTO {TBL_NM}
select customer_cde,'CARD_FAV_BRANCH_LOC_6M' FTR_NM ,sub_branch_cde FTR_VAL, TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, CURRENT_TIMESTAMP ADD_TSTP from 
(
select customer_cde, sub_branch_cde, 
       count(*) ct_txn_sub_branch, row_number()over(partition by customer_cde order by count(*) desc) rn1
from
(
select customer_cde, sub_branch_cde,cardhdr_no, 
        approval_cde, retrvl_refno,
        process_dt, 
        row_number()over(partition by customer_cde,cardhdr_no, approval_cde, retrvl_refno order by process_dt desc) rn from 
(
 select customer_cde, trim(' ' from(sub_branch_cde)) sub_branch_cde,cardhdr_no, 
        trim(' ' from (approval_cde)) approval_cde, retrvl_refno,
        process_dt
        from DW_ANALYTICS.dw_card_transaction_fct
        where process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6)
        and tran_status = 'S' 
        and  CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
))
where rn = 1
group by customer_cde, sub_branch_cde)
where rn1 = 1;
 
INSERT INTO {TBL_NM}
select customer_cde,'CARD_FAV_BRANCH_LOC_3M' FTR_NM ,sub_branch_cde FTR_VAL, TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, CURRENT_TIMESTAMP ADD_TSTP from 
(
select customer_cde, sub_branch_cde, 
       count(*) ct_txn_sub_branch, row_number()over(partition by customer_cde order by count(*) desc) rn1
from
(
select customer_cde, sub_branch_cde,cardhdr_no, 
        approval_cde, retrvl_refno,
        process_dt, 
        row_number()over(partition by customer_cde,cardhdr_no, approval_cde, retrvl_refno order by process_dt desc) rn from 
(
 select customer_cde, trim(' ' from(sub_branch_cde)) sub_branch_cde,cardhdr_no, 
        trim(' ' from (approval_cde)) approval_cde, retrvl_refno,
        process_dt
        from DW_ANALYTICS.dw_card_transaction_fct
        where process_dt < TO_DATE('{RPT_DT}','DD-MM-YY') AND process_dt >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -3)
        and tran_status = 'S' 
        and  CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
))
where rn = 1
group by customer_cde, sub_branch_cde)
where rn1 = 1;
 
INSERT INTO {TBL_NM}
SELECT B.CUSTOMER_CDE, 'CREDIT_SCORE' FTR_NM,
        CASE WHEN A.CREDIT_SCORE IS NULL THEN 0
             ELSE A.CREDIT_SCORE 
        END FTR_VAL,
        TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
        CURRENT_TIMESTAMP ADD_TSTP
FROM
(
    SELECT CUSTOMER_CDE, CREDIT_SCORE FROM
(
    select CUSTOMER_CDE, CREDIT_SCORE, DATE_1,PROCESS_DATE, ROW_NUMBER()OVER(PARTITION BY CUSTOMER_CDE ORDER BY CREDIT_SCORE DESC) RN 
    FROM
(
    select trim(' ' from(customer_cde))customer_cde,
           NVL(FINANCIALSCORE,NONFINANCIALSCORE) CREDIT_SCORE,
           RANK()OVER(PARTITION BY CUSTOMER_CDE ORDER BY DATE_1 DESC)RANK_SCORE,
          date_1, PROCESS_DATE
    from DW_ANALYTICS.stg_crs_customer_score
)
    where RANK_SCORE = 1 AND TO_DATE(DATE_1) < TO_DATE('{RPT_DT}','DD-MM-YY')
)
WHERE RN = 1
) A
RIGHT JOIN 
(
    SELECT CUSTOMER_CDE FROM DW_ANALYTICS.DW_CUSTOMER_DIM
    WHERE SUB_SECTOR_CDE IN ('1700','1602') AND ACTIVE = '1' AND COMPANY_KEY = '1') B
ON A.CUSTOMER_CDE = B.CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT 
CUSTOMER_CDE, 
'CASA_AVG_BAL_1M' AS FTR_NM,
AVG(ACTUAL_BAL_LCL) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP ADD_TSTP
FROM DW_ANALYTICS.DW_DEPOSIT_FCT
WHERE CATEGORY_CDE LIKE '10__'
AND CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -1) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT 
CUSTOMER_CDE, 
'CASA_MAX_BAL_1M' AS FTR_NM,
MAX(ACTUAL_BAL_LCL) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP ADD_TSTP
FROM DW_ANALYTICS.DW_DEPOSIT_FCT
WHERE CATEGORY_CDE LIKE '10__'
AND CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -1) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT 
CUSTOMER_CDE, 
'CASA_MIN_BAL_1M' AS FTR_NM,
MIN(ACTUAL_BAL_LCL) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP ADD_TSTP
FROM DW_ANALYTICS.DW_DEPOSIT_FCT
WHERE CATEGORY_CDE LIKE '10__'
AND CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -1) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
 'CARD_CREDIT_MAX_LIMIT' AS FTR_NM,
 MAX(TT_CARD_LIMIT) AS FTR_VAL,
 TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
 CURRENT_TIMESTAMP ADD_TSTP
FROM DW_ANALYTICS.DATA_RPT_CARD_493 
WHERE CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
AND SUBSTR(CARD_CDE,1,1) = '3'
AND CARD_CDE IN (SELECT CARD_CDE FROM CINS_TMP_CARD_DIM_TEST)
AND PROCESS_DT >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -36)
AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
WITH A AS
(
SELECT CUSTOMER_CDE,
    LAST_SIGNED_ON,
    ROW_NUMBER() OVER (PARTITION BY CUSTOMER_CDE ORDER BY LAST_SIGNED_ON DESC) RN
    FROM DW_ANALYTICS.DW_EWALL_USER_DIM
    WHERE USER_STATUS = 'A'
        AND CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
)

SELECT CUSTOMER_CDE,
    'EB_SACOMPAY_DAY_SINCE_LTST_LOGIN' AS FTR_NM,
    AVG(EXTRACT(DAY FROM (TO_DATE('{RPT_DT}','DD-MM-YY') - TO_DATE(LAST_SIGNED_ON)))) AS FTR_VAL,
    TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
 CURRENT_TIMESTAMP AS ADD_TSTP
    FROM A
    WHERE TO_DATE(LAST_SIGNED_ON) < TO_DATE('{RPT_DT}','DD-MM-YY')
 AND TO_DATE(LAST_SIGNED_ON) >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -36)
    AND RN = 1
    GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_CT_TXN_DOM_1M' AS FTR_NM,
COUNT(*) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE ACQ_CNTRY_CDE = '704'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -1) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_CT_TXN_DOM_3M' AS FTR_NM,
COUNT(*) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE ACQ_CNTRY_CDE = '704'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -3) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_CT_TXN_DOM_6M' AS FTR_NM,
COUNT(*) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE ACQ_CNTRY_CDE = '704'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_CT_TXN_DOM_12M' AS FTR_NM,
COUNT(*) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE ACQ_CNTRY_CDE = '704'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -12) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_CT_TXN_INTER_1M' AS FTR_NM,
COUNT(*) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE ACQ_CNTRY_CDE <> '704'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -1) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_CT_TXN_INTER_3M' AS FTR_NM,
COUNT(*) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE ACQ_CNTRY_CDE <> '704'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -3) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_CT_TXN_INTER_6M' AS FTR_NM,
COUNT(*) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE ACQ_CNTRY_CDE <> '704'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_CT_TXN_INTER_12M' AS FTR_NM,
COUNT(*) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE ACQ_CNTRY_CDE <> '704'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -12) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_CT_TXN_ONLINE_1M' AS FTR_NM,
COUNT(*) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE TXN_OL_CDE = 'E'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -1) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_CT_TXN_ONLINE_3M' AS FTR_NM,
COUNT(*) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE TXN_OL_CDE = 'E'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -3) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_CT_TXN_ONLINE_6M' AS FTR_NM,
COUNT(*) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE TXN_OL_CDE = 'E'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_CT_TXN_ONLINE_12M' AS FTR_NM,
COUNT(*) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE TXN_OL_CDE = 'E'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -12) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_CT_TXN_OFFLINE_1M' AS FTR_NM,
COUNT(*) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE TXN_OL_CDE NOT IN ('E')
AND TXN_OL_CDE IS NOT NULL
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -1) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_CT_TXN_OFFLINE_3M' AS FTR_NM,
COUNT(*) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE TXN_OL_CDE NOT IN ('E')
AND TXN_OL_CDE IS NOT NULL
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -3) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_CT_TXN_OFFLINE_6M' AS FTR_NM,
COUNT(*) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE TXN_OL_CDE NOT IN ('E')
AND TXN_OL_CDE IS NOT NULL
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_CT_TXN_OFFLINE_12M' AS FTR_NM,
COUNT(*) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE TXN_OL_CDE NOT IN ('E')
AND TXN_OL_CDE IS NOT NULL
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -12) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_SUM_TXN_DOM_1M' AS FTR_NM,
SUM(AMT_BILL) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE ACQ_CNTRY_CDE = '704'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -1) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_SUM_TXN_DOM_3M' AS FTR_NM,
SUM(AMT_BILL) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE ACQ_CNTRY_CDE = '704'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -3) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_SUM_TXN_DOM_6M' AS FTR_NM,
SUM(AMT_BILL) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE ACQ_CNTRY_CDE = '704'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_SUM_TXN_DOM_12M' AS FTR_NM,
SUM(AMT_BILL) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE ACQ_CNTRY_CDE = '704'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -12) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_SUM_TXN_INTER_1M' AS FTR_NM,
SUM(AMT_BILL) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE ACQ_CNTRY_CDE <> '704'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -1) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_SUM_TXN_INTER_3M' AS FTR_NM,
SUM(AMT_BILL) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE ACQ_CNTRY_CDE <> '704'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -3) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_SUM_TXN_INTER_6M' AS FTR_NM,
SUM(AMT_BILL) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE ACQ_CNTRY_CDE <> '704'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_SUM_TXN_INTER_12M' AS FTR_NM,
SUM(AMT_BILL) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE ACQ_CNTRY_CDE <> '704'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -12) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_SUM_TXN_ONLINE_1M' AS FTR_NM,
SUM(AMT_BILL) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE TXN_OL_CDE = 'E'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -1) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_SUM_TXN_ONLINE_3M' AS FTR_NM,
SUM(AMT_BILL) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE TXN_OL_CDE = 'E'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -3) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_SUM_TXN_ONLINE_6M' AS FTR_NM,
SUM(AMT_BILL) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE TXN_OL_CDE = 'E'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_SUM_TXN_ONLINE_12M' AS FTR_NM,
SUM(AMT_BILL) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE TXN_OL_CDE = 'E'
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -12) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_SUM_TXN_OFFLINE_1M' AS FTR_NM,
SUM(AMT_BILL) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE TXN_OL_CDE NOT IN ('E')
AND TXN_OL_CDE IS NOT NULL
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -1) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_SUM_TXN_OFFLINE_3M' AS FTR_NM,
SUM(AMT_BILL) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE TXN_OL_CDE NOT IN ('E')
AND TXN_OL_CDE IS NOT NULL
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -3) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_SUM_TXN_OFFLINE_6M' AS FTR_NM,
SUM(AMT_BILL) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE TXN_OL_CDE NOT IN ('E')
AND TXN_OL_CDE IS NOT NULL
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_SUM_TXN_OFFLINE_12M' AS FTR_NM,
SUM(AMT_BILL) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE TXN_OL_CDE NOT IN ('E')
AND TXN_OL_CDE IS NOT NULL
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -12) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
WITH A AS 
(
SELECT CUSTOMER_CDE
        ,PRODUCT_CDE
        ,PROCESS_DT
    FROM
        (SELECT CUSTOMER_CDE
            , PRODUCT_CDE
            , PROCESS_DT
            , ROW_NUMBER() OVER (PARTITION BY CUSTOMER_CDE, CARD_CDE, PROCESS_DT, APPROVAL_CDE, RETRVL_REFNO ORDER BY NULL) RN
        FROM DW_ANALYTICS.DW_CARD_TRANSACTION_FCT
        WHERE SUBSTR(CARD_CDE,1,1) = '3'
            AND CUSTOMER_CDE IN 
                (SELECT CUSTOMER_CDE 
                FROM CINS_TMP_CUST_TEST)
        ) 
WHERE RN = 1
)
SELECT CUSTOMER_CDE,
'CARD_CREDIT_UP_SELL_LABEL3_6M' AS FTR_NM,
COUNT(*) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM A
WHERE PRODUCT_CDE IN ('3024', '9413', '9415')
AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
AND PROCESS_DT >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -36)
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT A.CUSTOMER_CDE
,'CARD_CREDIT_LIMIT_TXN_M1' AS FTR_NM
,ROUND(A.AMT_BILL/B.TT_CARD_LIMIT,4) AS FTR_VAL
,TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT
,CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE, SUM(AMT_BILL) AS AMT_BILL FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST  
WHERE CUSTOMER_CDE IS NOT NULL
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -1) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE
) A
LEFT JOIN 
(SELECT CUSTOMER_CDE, SUM(TT_CARD_LIMIT) AS TT_CARD_LIMIT FROM CINS_TMP_DATA_RPT_CARD_{RPT_DT}_TEST GROUP BY CUSTOMER_CDE) B 
ON A.CUSTOMER_CDE = B.CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT A.CUSTOMER_CDE
,'CARD_CREDIT_LIMIT_TXN_M3' AS FTR_NM
,ROUND(A.AMT_BILL/B.TT_CARD_LIMIT,4) AS FTR_VAL
,TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT
,CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE, SUM(AMT_BILL) AS AMT_BILL FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST  
WHERE CUSTOMER_CDE IS NOT NULL
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -3) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE
) A
LEFT JOIN 
(SELECT CUSTOMER_CDE, SUM(TT_CARD_LIMIT)*3 AS TT_CARD_LIMIT FROM CINS_TMP_DATA_RPT_CARD_{RPT_DT}_TEST GROUP BY CUSTOMER_CDE) B 
ON A.CUSTOMER_CDE = B.CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT A.CUSTOMER_CDE
,'CARD_CREDIT_LIMIT_TXN_M6' AS FTR_NM
,ROUND(A.AMT_BILL/B.TT_CARD_LIMIT,4) AS FTR_VAL
,TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT
,CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE, SUM(AMT_BILL) AS AMT_BILL FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST  
WHERE CUSTOMER_CDE IS NOT NULL
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE
) A
LEFT JOIN 
(SELECT CUSTOMER_CDE, SUM(TT_CARD_LIMIT)*6 AS TT_CARD_LIMIT FROM CINS_TMP_DATA_RPT_CARD_{RPT_DT}_TEST GROUP BY CUSTOMER_CDE) B 
ON A.CUSTOMER_CDE = B.CUSTOMER_CDE;





INSERT INTO {TBL_NM}
WITH T AS
(
SELECT A.CUSTOMER_CDE, A.CARD_CDE, A.CREDIT_BRAND,B.TT_CARD_LIMIT
FROM
(SELECT CUSTOMER_CDE, CARD_CDE, 
CASE WHEN SUBSTR(CARDHOLDER_NO,1,1) = '4' THEN 'VISA'
     WHEN SUBSTR(CARDHOLDER_NO,1,1) = '3' THEN 'JCB'
     WHEN SUBSTR(CARDHOLDER_NO,1,1) = '5' THEN 'MASTERCARD'
     WHEN SUBSTR(CARDHOLDER_NO,1,1) = '6' THEN 'UNION'
     WHEN (SUBSTR(CARDHOLDER_NO,1) = '9' OR SUBSTR(CARDHOLDER_NO,1) = '2') THEN 'NAPAS'
     ELSE 'OTHER' END AS CREDIT_BRAND
,ROW_NUMBER() OVER (PARTITION BY CUSTOMER_CDE, CARD_CDE ORDER BY UPDATE_DT DESC) RN
FROM DW_ANALYTICS.DW_CARD_MASTER_DIM
WHERE SUBSTR(CARD_CDE,1,1) = '3'
AND PLASTIC_CDE = ' '
AND STATUS_CDE = ' '
) A
JOIN 
(
SELECT CUSTOMER_CDE,CARD_CDE, MAX(TT_CARD_LIMIT) AS TT_CARD_LIMIT
FROM CINS_TMP_DATA_RPT_CARD_{RPT_DT}_TEST GROUP BY CUSTOMER_CDE,CARD_CDE
) B ON A.CUSTOMER_CDE = B.CUSTOMER_CDE AND A.CARD_CDE = B.CARD_CDE
WHERE A.RN = 1
)
 
SELECT CUSTOMER_CDE,
'CARD_CREDIT_MAX_BRAND_LIMIT' AS FTR_NM,
CREDIT_BRAND AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE,
CREDIT_BRAND,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE ORDER BY TT_CARD_LIMIT DESC) RN
FROM T WHERE CUSTOMER_CDE <> '1' AND CUSTOMER_CDE <> '-1'
) WHERE RN = 1
;





INSERT INTO {TBL_NM}
WITH A AS
(
SELECT DISTINCT CUSTOMER_CDE, CARD_CDE, 
CASE 
  WHEN (SUBSTR(CARDHOLDER_NO,1,6) = '512341' OR SUBSTR(CARDHOLDER_NO,1,6) = '356480' OR SUBSTR(CARDHOLDER_NO,1,6) = '472074'
  OR SUBSTR(CARDHOLDER_NO,1,6) = '970403' OR SUBSTR(CARDHOLDER_NO,1,6) = '211241' OR SUBSTR(CARDHOLDER_NO,1,6) = '486265') THEN '1'
  WHEN (SUBSTR(CARDHOLDER_NO,1,6) = '472075' OR SUBSTR(CARDHOLDER_NO,1,6) = '356481' OR SUBSTR(CARDHOLDER_NO,1,6) = '526830' 
        OR SUBSTR(CARDHOLDER_NO,1,6) = '625002') THEN '2'    
     WHEN (SUBSTR(CARDHOLDER_NO,1,6) = '436438' OR SUBSTR(CARDHOLDER_NO,1,6) = '423238') THEN '3'
  WHEN SUBSTR(CARDHOLDER_NO,1,6) = '455376' THEN '4'
  WHEN (SUBSTR(CARDHOLDER_NO,1,6) = '555715' OR SUBSTR(CARDHOLDER_NO,1,6) = '552332') THEN '5'     
     WHEN SUBSTR(CARDHOLDER_NO,1,6) = '356062' THEN '6'
     WHEN SUBSTR(CARDHOLDER_NO,1,6) = '466243' THEN '7'
     ELSE '0' END AS CREDIT_CLASS
FROM DW_ANALYTICS.DW_CARD_MASTER_DIM
WHERE ACTIVATION_DT <= TO_DATE('{RPT_DT}','DD-MM-YY')
AND ACTIVATION_DT >= ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -36)
AND SUBSTR(CARD_CDE,1,1) = '3'
AND PLASTIC_CDE = ' '
AND STATUS_CDE = ' '
AND CUSTOMER_CDE <> '-1' AND CUSTOMER_CDE IS NOT NULL AND CUSTOMER_CDE NOT LIKE '%#%'
)

SELECT CUSTOMER_CDE,
'CARD_CREDIT_MAX_CLASS' AS FTR_NM,
MAX(CREDIT_CLASS) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE, CARD_CDE, CAST(CREDIT_CLASS AS INT) AS CREDIT_CLASS
FROM A
)
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT A.CUSTOMER_CDE
 ,'CARD_CREDIT_OVER_LIMIT_20_70_6M' AS FTR_NM
 ,CASE WHEN (ROUND(A.AMT_BILL/B.TT_CARD_LIMIT,4) >= 1.2000 AND ROUND(A.AMT_BILL/B.TT_CARD_LIMIT,4) <= 1.7000) THEN 1
     ELSE 0 
     END AS FTR_VAL
 ,TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT
 ,CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE, SUM(AMT_BILL) AS AMT_BILL FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST  
 WHERE CUSTOMER_CDE IS NOT NULL
 AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
 GROUP BY CUSTOMER_CDE
) A
LEFT JOIN 
(SELECT CUSTOMER_CDE, SUM(TT_CARD_LIMIT)*6 AS TT_CARD_LIMIT FROM CINS_TMP_DATA_RPT_CARD_{RPT_DT}_TEST GROUP BY CUSTOMER_CDE) B 
 ON A.CUSTOMER_CDE = B.CUSTOMER_CDE;





INSERT INTO {TBL_NM}
WITH A AS
(SELECT CUSTOMER_CDE,
  SUM(CASE WHEN (TXN_OL_CDE = 'C' OR TXN_OL_CDE = 'Z' OR TXN_OL_CDE = 'S') THEN AMT_BILL ELSE 0 END) AS AMOUNT_CASH,
  SUM(CASE WHEN TXN_OL_CDE NOT IN ('C','Z','S') THEN AMT_BILL ELSE 0 END) AS AMOUNT_SALE
  FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
  WHERE ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
  GROUP BY CUSTOMER_CDE
)

SELECT   CUSTOMER_CDE,
  'CARD_CREDIT_AMOUNT_CASH_LESS_30_6M' AS FTR_NM,
  CASE WHEN (AMOUNT_CASH + AMOUNT_SALE) > 0 AND AMOUNT_CASH/(AMOUNT_CASH + AMOUNT_SALE) < 0.3 THEN 1 ELSE 0 END AS FTR_VAL,
  TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
  CURRENT_TIMESTAMP AS ADD_TSTP
  FROM A;





INSERT INTO {TBL_NM}
WITH A AS
(SELECT CUSTOMER_CDE,
  SUM(CASE WHEN (TXN_OL_CDE = 'C' OR TXN_OL_CDE = 'Z' OR TXN_OL_CDE = 'S') THEN AMT_BILL ELSE 0 END) AS AMOUNT_CASH,
  SUM(CASE WHEN TXN_OL_CDE NOT IN ('C','Z','S') AND MCC_CDE IN ('7631', '5944') THEN AMT_BILL ELSE 0 END) AS AMOUNT_SALE_MCC_VANG
  FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
  WHERE ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
  GROUP BY CUSTOMER_CDE
)

SELECT CUSTOMER_CDE,
  'CARD_CREDIT_AMOUNT_SALE_MCC_VANG_50_6M' AS FTR_NM,
  CASE WHEN (AMOUNT_CASH + AMOUNT_SALE_MCC_VANG) > 0 AND AMOUNT_SALE_MCC_VANG/(AMOUNT_CASH + AMOUNT_SALE_MCC_VANG) < 0.5 THEN 1 ELSE 0 END AS FTR_VAL,
  TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
  CURRENT_TIMESTAMP AS ADD_TSTP
FROM A;





INSERT INTO {TBL_NM}
WITH AA AS
(SELECT CUSTOMER_CDE,
  ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE ORDER BY ACTIVATION_DT DESC) RN
  FROM DW_ANALYTICS.DW_CARD_MASTER_DIM
  WHERE SUBSTR(CARD_CDE,1,1) = '3' AND PLASTIC_CDE = ' ' AND STATUS_CDE = ' '
  AND EXTRACT(DAY FROM (TO_DATE('{RPT_DT}','DD-MM-YY') - TO_DATE(ACTIVATION_DT))) >= 180
)

SELECT CUSTOMER_CDE,
  'CARD_CREDIT_NON_DEBT_GRP_6M' AS FTR_NM,
  CASE WHEN CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_DATA_RPT_LOAN_{RPT_DT}_TEST WHERE TT_LOAN_GROUP = 1) THEN 1
  ELSE 0 END AS FTR_VAL,
  TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
  CURRENT_TIMESTAMP AS ADD_TSTP
  FROM AA WHERE CUSTOMER_CDE IS NOT NULL
  AND CUSTOMER_CDE <> '-1' AND CUSTOMER_CDE <> '1'
  AND RN = 1;





INSERT INTO {TBL_NM}
WITH A AS
(
SELECT CUSTOMER_CDE,
SUM(AMT_BILL) AS AMT_BILL
FROM
(SELECT CUSTOMER_CDE
    ,ABS(AMT_BILL) AS AMT_BILL
    FROM DW_ANALYTICS.DW_CARD_TRANSACTION_FCT
    WHERE UPPER(TXN_OM_CDE) IN ('PATM','PAUTO','PBRCHCH','PMTQRV','PMTCUP','PMTIPM', 'PMTBII') 
    AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
    AND SUBSTR(CARD_CDE,1,1) = '3'
    AND CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
    AND CUSTOMER_CDE <> '1' AND CUSTOMER_CDE <> '-1' AND CUSTOMER_CDE NOT LIKE '%#%'
)
GROUP BY CUSTOMER_CDE
),
B AS
(
SELECT CUSTOMER_CDE
    ,SUM(TT_ORIGINAL_BALANCE) AS TT_ORIGINAL_BALANCE
    FROM DW_ANALYTICS.DATA_RPT_CARD_493 
    WHERE CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
    AND SUBSTR(CARD_CDE,1,1) = '3'
    AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
    AND CUSTOMER_CDE <> '1' AND CUSTOMER_CDE <> '-1' AND CUSTOMER_CDE NOT LIKE '%#%'
    GROUP BY CUSTOMER_CDE
)
SELECT A.CUSTOMER_CDE,
    'CARD_CREDIT_CASH_RATIO_30_6M' AS FTR_NM,
    CASE WHEN  A.AMT_BILL/B.TT_ORIGINAL_BALANCE > 0.3 AND B.TT_ORIGINAL_BALANCE <> 0 THEN 1 ELSE 0 END AS FTR_VAL,
    TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
 CURRENT_TIMESTAMP AS ADD_TSTP 
FROM A A
LEFT JOIN B B
ON A.CUSTOMER_CDE = B.CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE, 
'CARD_CREDIT_UP_SELL_LABEL1_6M' AS FTR_NM,
FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE, 
CASE WHEN REASON = 'UD' THEN 1 ELSE 0 END AS FTR_VAL,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE ORDER BY UPDATE_DT DESC) RN
FROM DW_ANALYTICS.DW_CARD_MASTER_DIM
WHERE STATUS_CDE = ' ' AND PLASTIC_CDE = ' '
)
WHERE RN = 1 AND FTR_VAL = 1;





INSERT INTO {TBL_NM}
WITH A AS
(
SELECT CUSTOMER_CDE,PROCESS_DT,ROUND(SUM(AMT_BILL)/COUNT(*),2) AS TICKET_SIZE FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST WHERE
ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -3) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE,PROCESS_DT
)

SELECT B.CUSTOMER_CDE,
'CARD_CREDIT_UP_SELL_LABEL2_6M' AS FTR_NM,
CASE WHEN 
(B.TICKET_SIZE_N0 > B.TICKET_SIZE_N1 AND B.TICKET_SIZE_N1 > B.TICKET_SIZE_N2) AND (B.TICKET_SIZE_N0 <> 0 AND B.TICKET_SIZE_N1 <> 0 AND B.TICKET_SIZE_N2 <> 0)
THEN 1 ELSE 0 END AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(SELECT CUSTOMER_CDE, 
        SUM(CASE WHEN (ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -1) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')) THEN TICKET_SIZE
        ELSE 0 END) AS TICKET_SIZE_N0,
        SUM(CASE WHEN (ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -2) <= PROCESS_DT AND PROCESS_DT < ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -1)) THEN TICKET_SIZE
        ELSE 0 END) AS TICKET_SIZE_N1,
        SUM(CASE WHEN (ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -3) <= PROCESS_DT AND PROCESS_DT < ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -2)) THEN TICKET_SIZE
        ELSE 0 END) AS TICKET_SIZE_N2
        FROM A
        GROUP BY CUSTOMER_CDE
) B;





INSERT INTO {TBL_NM}
WITH A AS 
(
SELECT CUSTOMER_CDE
        ,PRODUCT_CDE
        ,PROCESS_DT
    FROM
        (SELECT CUSTOMER_CDE
            , PRODUCT_CDE
            , PROCESS_DT
            , ROW_NUMBER() OVER (PARTITION BY CUSTOMER_CDE, CARD_CDE, PROCESS_DT, APPROVAL_CDE, RETRVL_REFNO ORDER BY NULL) RN
        FROM DW_ANALYTICS.DW_CARD_TRANSACTION_FCT
        WHERE SUBSTR(CARD_CDE,1,1) = '3'
            AND CUSTOMER_CDE IN 
                (SELECT CUSTOMER_CDE 
                FROM CINS_TMP_CUST_TEST)
        ) 
WHERE RN = 1
)
SELECT CUSTOMER_CDE,
'CARD_CREDIT_CT_CONSUMP_LOAN' AS FTR_NM,
COUNT(*) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM A
WHERE PRODUCT_CDE IN ('3024', '9413', '9415')
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
GROUP BY CUSTOMER_CDE;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'CARD_CREDIT_UP_SELL_LABEL4_6M' AS FTR_NM,
FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(SELECT CUSTOMER_CDE,
CASE WHEN 
        PRODUCT_CDE IN ('4200','4201','4203','4204','4205','4207','4208','4210','4213','4214','4215','4216','4217','4218','4219','4220','4221','4224','4230','4231','4232','4233','4234','4235','4238','4240','4243','4244','4245','4246','4247','4248','4249','4250','4251','4252','4253','4254','4255','4256','4269','4271','4272','4277','4278','7203','7204','7205','7206','4600','4601','4603','4604','4605','4607','4608','4609','4610','4611','4612','4613','4614','4615','4616','4617','4618','5400','5401','5403','5404','5405','5407','5408','5409','5412','5413','5414','5415','5416','5417','5418','5419','5420','5421','5422','5423') THEN 1 
        ELSE 0 END AS FTR_VAL,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE ORDER BY PROCESS_DT DESC) RN
FROM CINS_TMP_CREDIT_CARD_TRANSACTION_TEST
WHERE PRODUCT_CDE IS NOT NULL
AND ADD_MONTHS(TO_DATE('{RPT_DT}','DD-MM-YY'), -6) <= PROCESS_DT AND PROCESS_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
)
WHERE RN = 1 AND FTR_VAL = 1
;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE, 
    'CARD_CREDIT_HOLD' AS FTR_NM,
    '1' AS FTR_VAL,
    TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
    CURRENT_TIMESTAMP AS ADD_TSTP
    FROM 
    (
    SELECT DISTINCT CUSTOMER_CDE FROM DW_ANALYTICS.DW_CARD_MASTER_DIM 
    WHERE SUBSTR(CARD_CDE,1,1) = '3' AND STATUS_CDE = ' ' AND BASIC_SUPP_IND = 'B' AND TO_CHAR(LAST_RENEWAL_DT) = '01-JAN-00' 
 AND ACTIVATION_DT <= TO_DATE('{RPT_DT}','DD-MM-YY')
    AND CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
    );





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE, 
    'CASA_HOLD' AS FTR_NM,
    '1' AS FTR_VAL,
    TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
    CURRENT_TIMESTAMP AS ADD_TSTP
    FROM 
    (
 SELECT DISTINCT CUSTOMER_CDE
 FROM DW_ANALYTICS.DW_ACCOUNT_MASTER_DIM
 WHERE ACTIVE = 1 AND COMPANY_KEY = 1 AND SUB_SECTOR_CDE IN ('1700','1602')
 AND CATEGORY_CDE LIKE '10__' AND TO_CHAR(CLOSE_DT) = '01-JAN-00'
 AND OPEN_DT <= TO_DATE('{RPT_DT}','DD-MM-YY')
    );





INSERT INTO {TBL_NM}
WITH A AS
(
SELECT CUSTOMER_CDE, CARD_CDE, ACTIVATION_DT
FROM 
(SELECT CUSTOMER_CDE, CARD_CDE, ACTIVATION_DT,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE, CARD_CDE ORDER BY UPDATE_DT DESC) RN
FROM DW_ANALYTICS.DW_CARD_MASTER_DIM
WHERE SUBSTR(CARD_CDE,1,1) = '3' AND STATUS_CDE = ' ' AND PLASTIC_CDE = ' ' AND BASIC_SUPP_IND = 'B' 
AND TO_CHAR(LAST_RENEWAL_DT) = '01-JAN-00' 
AND CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
)
WHERE RN =1
)

SELECT CUSTOMER_CDE, 
'CARD_CREDIT_CROSS_SELL_LABEL1' AS FTR_NM,
TO_CHAR(ACTIVATION_DT) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE, CARD_CDE, ACTIVATION_DT,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE ORDER BY ACTIVATION_DT DESC) RN
FROM A
WHERE ACTIVATION_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
)
WHERE RN = 1;





INSERT INTO {TBL_NM}
WITH A AS
(
SELECT CUSTOMER_CDE, CARD_CDE, ACTIVATION_DT
FROM 
(SELECT CUSTOMER_CDE, CARD_CDE, ACTIVATION_DT,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE, CARD_CDE ORDER BY UPDATE_DT DESC) RN
FROM DW_ANALYTICS.DW_CARD_MASTER_DIM
WHERE SUBSTR(CARD_CDE,1,1) = '3' AND STATUS_CDE = ' ' AND PLASTIC_CDE = ' ' AND BASIC_SUPP_IND = 'B' 
AND TO_CHAR(LAST_RENEWAL_DT) = '01-JAN-00' 
AND CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
)
WHERE RN =1
)

SELECT CUSTOMER_CDE, 
'CARD_CREDIT_CROSS_SELL_LABEL2' AS FTR_NM,
TO_CHAR(ACTIVATION_DT) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE, CARD_CDE, ACTIVATION_DT,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE ORDER BY ACTIVATION_DT DESC) RN
FROM A
WHERE ACTIVATION_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
)
WHERE RN = 2;





INSERT INTO {TBL_NM}
WITH A AS
(
SELECT CUSTOMER_CDE, CARD_CDE, ACTIVATION_DT
FROM 
(SELECT CUSTOMER_CDE, CARD_CDE, ACTIVATION_DT,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE, CARD_CDE ORDER BY UPDATE_DT DESC) RN
FROM DW_ANALYTICS.DW_CARD_MASTER_DIM
WHERE SUBSTR(CARD_CDE,1,1) = '3' AND STATUS_CDE = ' ' AND PLASTIC_CDE = ' ' AND BASIC_SUPP_IND = 'B' 
AND TO_CHAR(LAST_RENEWAL_DT) = '01-JAN-00' 
AND CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
)
WHERE RN =1
)

SELECT CUSTOMER_CDE, 
'CARD_CREDIT_CROSS_SELL_LABEL3' AS FTR_NM,
TO_CHAR(ACTIVATION_DT) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE, CARD_CDE, ACTIVATION_DT,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE ORDER BY ACTIVATION_DT DESC) RN
FROM A
WHERE ACTIVATION_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
)
WHERE RN = 3;





INSERT INTO {TBL_NM}
WITH A AS
(
SELECT CUSTOMER_CDE, CARD_CDE, ACTIVATION_DT
FROM 
(SELECT CUSTOMER_CDE, CARD_CDE, ACTIVATION_DT,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE, CARD_CDE ORDER BY UPDATE_DT DESC) RN
FROM DW_ANALYTICS.DW_CARD_MASTER_DIM
WHERE SUBSTR(CARD_CDE,1,1) = '3' AND STATUS_CDE = ' ' AND PLASTIC_CDE = ' ' AND BASIC_SUPP_IND = 'B' 
AND TO_CHAR(LAST_RENEWAL_DT) = '01-JAN-00' 
AND CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
)
WHERE RN =1
)

SELECT CUSTOMER_CDE, 
'CARD_CREDIT_CROSS_SELL_LABEL4' AS FTR_NM,
TO_CHAR(ACTIVATION_DT) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE, CARD_CDE, ACTIVATION_DT,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE ORDER BY ACTIVATION_DT DESC) RN
FROM A
WHERE ACTIVATION_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
)
WHERE RN = 4;





INSERT INTO {TBL_NM}
WITH A AS
(
SELECT CUSTOMER_CDE, CARD_CDE, ACTIVATION_DT
FROM 
(SELECT CUSTOMER_CDE, CARD_CDE, ACTIVATION_DT,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE, CARD_CDE ORDER BY UPDATE_DT DESC) RN
FROM DW_ANALYTICS.DW_CARD_MASTER_DIM
WHERE SUBSTR(CARD_CDE,1,1) = '3' AND STATUS_CDE = ' ' AND PLASTIC_CDE = ' ' AND BASIC_SUPP_IND = 'B' 
AND TO_CHAR(LAST_RENEWAL_DT) = '01-JAN-00' 
AND CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
)
WHERE RN =1
)

SELECT CUSTOMER_CDE, 
'CARD_CREDIT_CROSS_SELL_LABEL5' AS FTR_NM,
TO_CHAR(ACTIVATION_DT) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE, CARD_CDE, ACTIVATION_DT,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE ORDER BY ACTIVATION_DT DESC) RN
FROM A
WHERE ACTIVATION_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
)
WHERE RN = 5;





INSERT INTO {TBL_NM}
WITH A AS
(
SELECT CUSTOMER_CDE, CARD_CDE, ACTIVATION_DT
FROM 
(SELECT CUSTOMER_CDE, CARD_CDE, ACTIVATION_DT,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE, CARD_CDE ORDER BY UPDATE_DT DESC) RN
FROM DW_ANALYTICS.DW_CARD_MASTER_DIM
WHERE SUBSTR(CARD_CDE,1,1) = '3' AND STATUS_CDE = ' ' AND PLASTIC_CDE = ' ' AND BASIC_SUPP_IND = 'B' 
AND TO_CHAR(LAST_RENEWAL_DT) = '01-JAN-00' 
AND CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
)
WHERE RN =1
)

SELECT CUSTOMER_CDE, 
'CARD_CREDIT_CROSS_SELL_LABEL6' AS FTR_NM,
TO_CHAR(ACTIVATION_DT) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE, CARD_CDE, ACTIVATION_DT,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE ORDER BY ACTIVATION_DT DESC) RN
FROM A
WHERE ACTIVATION_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
)
WHERE RN = 6;






INSERT INTO {TBL_NM}
WITH A AS
(
SELECT CUSTOMER_CDE, ACCT_ID, OPEN_DT FROM
(
SELECT CUSTOMER_CDE
,ACCT_ID
,OPEN_DT
,ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE, ACCT_ID ORDER BY UPDATE_DT DESC) RN
FROM DW_ANALYTICS.DW_ACCOUNT_MASTER_DIM
WHERE ACTIVE = 1 AND COMPANY_KEY = 1 AND SUB_SECTOR_CDE IN ('1700','1602')
AND CATEGORY_CDE LIKE '10__' AND TO_CHAR(CLOSE_DT) = '01-JAN-00'
)
WHERE RN = 1
)

SELECT CUSTOMER_CDE,
'CASA_CROSS_SELL_LABEL1' AS FTR_NM,
TO_CHAR(OPEN_DT) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE, ACCT_ID, OPEN_DT,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE ORDER BY OPEN_DT DESC) RN
FROM A
WHERE OPEN_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
)
WHERE RN = 1; 






INSERT INTO {TBL_NM}
WITH A AS
(
SELECT CUSTOMER_CDE, ACCT_ID, OPEN_DT FROM
(
SELECT CUSTOMER_CDE
,ACCT_ID
,OPEN_DT
,ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE, ACCT_ID ORDER BY UPDATE_DT DESC) RN
FROM DW_ANALYTICS.DW_ACCOUNT_MASTER_DIM
WHERE ACTIVE = 1 AND COMPANY_KEY = 1 AND SUB_SECTOR_CDE IN ('1700','1602')
AND CATEGORY_CDE LIKE '10__' AND TO_CHAR(CLOSE_DT) = '01-JAN-00'
)
WHERE RN = 1
)

SELECT CUSTOMER_CDE,
'CASA_CROSS_SELL_LABEL2' AS FTR_NM,
TO_CHAR(OPEN_DT) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE, ACCT_ID, OPEN_DT,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE ORDER BY OPEN_DT DESC) RN
FROM A
WHERE OPEN_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
)
WHERE RN = 2;






INSERT INTO {TBL_NM}
WITH A AS
(
SELECT CUSTOMER_CDE, ACCT_ID, OPEN_DT FROM
(
SELECT CUSTOMER_CDE
,ACCT_ID
,OPEN_DT
,ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE, ACCT_ID ORDER BY UPDATE_DT DESC) RN
FROM DW_ANALYTICS.DW_ACCOUNT_MASTER_DIM
WHERE ACTIVE = 1 AND COMPANY_KEY = 1 AND SUB_SECTOR_CDE IN ('1700','1602')
AND CATEGORY_CDE LIKE '10__' AND TO_CHAR(CLOSE_DT) = '01-JAN-00'
)
WHERE RN = 1
)

SELECT CUSTOMER_CDE,
'CASA_CROSS_SELL_LABEL3' AS FTR_NM,
TO_CHAR(OPEN_DT) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE, ACCT_ID, OPEN_DT,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE ORDER BY OPEN_DT DESC) RN
FROM A
WHERE OPEN_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
)
WHERE RN = 3;





INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'EB_MB_CROSS_SELL_LABEL1' AS FTR_NM,
TO_CHAR(INPUT_DT) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE, CORP_ID, INPUT_DT,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE ORDER BY INPUT_DT DESC) RN
FROM CINS_TMP_EB_MB_CROSSELL_TEST
WHERE INPUT_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
)
WHERE RN = 1
;






INSERT INTO {TBL_NM}
SELECT CUSTOMER_CDE,
'EB_MB_CROSS_SELL_LABEL2' AS FTR_NM,
TO_CHAR(INPUT_DT) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE, CORP_ID, INPUT_DT,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE ORDER BY INPUT_DT DESC) RN
FROM CINS_TMP_EB_MB_CROSSELL_TEST
WHERE INPUT_DT < TO_DATE('{RPT_DT}','DD-MM-YY')
)
WHERE RN = 2
;





INSERT INTO {TBL_NM}
WITH A AS 
(
SELECT CUSTOMER_CDE, EWALL_ID, FIRST_SIGNED_ON FROM
(
SELECT CUSTOMER_CDE, EWALL_ID, FIRST_SIGNED_ON,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE, EWALL_ID ORDER BY REC_UPDATE_DT DESC) RN
FROM DW_ANALYTICS.DW_EWALL_USER_DIM
WHERE CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
AND USER_STATUS = 'A'
)
WHERE RN = 1
)

SELECT CUSTOMER_CDE,
'SACOMBANK_PAY_CROSS_SELL_LABEL1' AS FTR_NM,
TO_CHAR(FIRST_SIGNED_ON) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE, EWALL_ID, FIRST_SIGNED_ON,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE ORDER BY FIRST_SIGNED_ON DESC) RN
FROM A
WHERE FIRST_SIGNED_ON < TO_DATE('{RPT_DT}','DD-MM-YY')
)
WHERE RN = 1
;





INSERT INTO {TBL_NM}
WITH A AS 
(
SELECT CUSTOMER_CDE, EWALL_ID, FIRST_SIGNED_ON FROM
(
SELECT CUSTOMER_CDE, EWALL_ID, FIRST_SIGNED_ON,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE, EWALL_ID ORDER BY REC_UPDATE_DT DESC) RN
FROM DW_ANALYTICS.DW_EWALL_USER_DIM
WHERE CUSTOMER_CDE IN (SELECT CUSTOMER_CDE FROM CINS_TMP_CUST_TEST)
AND USER_STATUS = 'A'
)
WHERE RN = 1
)

SELECT CUSTOMER_CDE,
'SACOMBANK_PAY_CROSS_SELL_LABEL2' AS FTR_NM,
TO_CHAR(FIRST_SIGNED_ON) AS FTR_VAL,
TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT,
CURRENT_TIMESTAMP AS ADD_TSTP
FROM
(
SELECT CUSTOMER_CDE, EWALL_ID, FIRST_SIGNED_ON,
ROW_NUMBER() OVER(PARTITION BY CUSTOMER_CDE ORDER BY FIRST_SIGNED_ON DESC) RN
FROM A
WHERE FIRST_SIGNED_ON < TO_DATE('{RPT_DT}','DD-MM-YY')
)
WHERE RN = 2
;










---LOR_SPLIT

---[0,2]---
INSERT INTO {TBL_NM}
SELECT A.CUSTOMER_CDE, 'LOR_SPLIT' FTR_NM, '[0,2]' FTR_VAL, TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, CURRENT_TIMESTAMP ADD_TSTP
FROM
(SELECT CUSTOMER_CDE,SUB_BRANCH_KEY
FROM DWPROD.DW_CUSTOMER_DIM WHERE SUB_SECTOR_CDE IN ('1700','1602') AND ACTIVE = '1' AND COMPANY_KEY = '1'
 )A 
JOIN (SELECT CUSTOMER_CDE,FTR_VAL FROM {TBL_NM} WHERE FTR_NM = 'LOR'
AND FTR_VAL >= 0 AND FTR_VAL <= 730 ) B
ON A.CUSTOMER_CDE = B.CUSTOMER_CDE;
COMMIT;


---[2,6]
INSERT INTO {TBL_NM}
SELECT A.CUSTOMER_CDE, 'LOR_SPLIT' FTR_NM, '[2,6]' FTR_VAL, TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, CURRENT_TIMESTAMP ADD_TSTP
FROM
(SELECT CUSTOMER_CDE,SUB_BRANCH_KEY
FROM DWPROD.DW_CUSTOMER_DIM WHERE SUB_SECTOR_CDE IN ('1700','1602') AND ACTIVE = '1' AND COMPANY_KEY = '1'
 )A 
JOIN (SELECT CUSTOMER_CDE,FTR_VAL FROM {TBL_NM} WHERE FTR_NM = 'LOR'
AND FTR_VAL > 730 AND FTR_VAL <= 2190 ) B
ON A.CUSTOMER_CDE = B.CUSTOMER_CDE;
COMMIT;



---[6,10]
INSERT INTO {TBL_NM}
SELECT A.CUSTOMER_CDE, 'LOR_SPLIT' FTR_NM, '[6,10]' FTR_VAL, TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, CURRENT_TIMESTAMP ADD_TSTP
FROM
(SELECT CUSTOMER_CDE,SUB_BRANCH_KEY
FROM DWPROD.DW_CUSTOMER_DIM WHERE SUB_SECTOR_CDE IN ('1700','1602') AND ACTIVE = '1' AND COMPANY_KEY = '1'
 )A 
JOIN (SELECT CUSTOMER_CDE,FTR_VAL FROM {TBL_NM} WHERE FTR_NM = 'LOR'
AND FTR_VAL > 2190 AND FTR_VAL <= 3650) B
ON A.CUSTOMER_CDE = B.CUSTOMER_CDE;
COMMIT;


---[10+]
INSERT INTO {TBL_NM}
SELECT A.CUSTOMER_CDE, 'LOR_SPLIT' FTR_NM, '[10,+]' FTR_VAL, TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, CURRENT_TIMESTAMP ADD_TSTP
FROM
(SELECT CUSTOMER_CDE,SUB_BRANCH_KEY
FROM DWPROD.DW_CUSTOMER_DIM WHERE SUB_SECTOR_CDE IN ('1700','1602') AND ACTIVE = '1' AND COMPANY_KEY = '1'
 )A 
JOIN (SELECT CUSTOMER_CDE,FTR_VAL FROM {TBL_NM} WHERE FTR_NM = 'LOR'
AND FTR_VAL > 3650) B
ON A.CUSTOMER_CDE = B.CUSTOMER_CDE;
COMMIT;


--- AREA_SPLIT

INSERT INTO {TBL_NM}
SELECT A.CUSTOMER_CDE,'AREA_SPLIT' FTR_NM, B.AREA_NAME FTR_VAL , TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, CURRENT_TIMESTAMP ADD_TSTP
FROM (SELECT CUSTOMER_CDE,SUB_BRANCH_KEY
FROM DWPROD.DW_CUSTOMER_DIM WHERE SUB_SECTOR_CDE IN ('1700','1602') AND ACTIVE = '1' AND COMPANY_KEY = '1'
AND UPDATE_DT <= TO_DATE('{RPT_DT}','DD-MM-YY')  )A 
JOIN (
SELECT * FROM DWPROD.DW_ORG_LOCATION_DIM 
WHERE ACTIVE = '1' AND COMPANY_KEY = '1') B 
ON A.SUB_BRANCH_KEY = B.SUB_BRANCH_KEY;
COMMIT;



--- PRODUCT_SPLIT

--MBIB
INSERT INTO {TBL_NM}
SELECT  CUSTOMER_CDE, 'PRODUCT_SPLIT' FTR_NM, 'IBMB' FTR_VAL , TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, CURRENT_TIMESTAMP ADD_TSTP FROM
{TBL_NM} 
WHERE FTR_NM = 'EB_MBIB_HOLD' AND FTR_VAL = 1;
COMMIT;

--SACOMPAY
INSERT INTO {TBL_NM}
SELECT  CUSTOMER_CDE, 'PRODUCT_SPLIT' FTR_NM, 'SACOMPAY' FTR_VAL , TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, CURRENT_TIMESTAMP ADD_TSTP FROM
{TBL_NM} 
WHERE FTR_NM = 'EB_SACOMPAY_HOLD' AND FTR_VAL = 1;
COMMIT;


---CARD
INSERT INTO {TBL_NM}
SELECT  CUSTOMER_CDE, 'PRODUCT_SPLIT' FTR_NM, 'CARD' FTR_VAL , TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, CURRENT_TIMESTAMP ADD_TSTP FROM
{TBL_NM} 
WHERE FTR_NM = 'CARD_CREDIT_HOLD' AND FTR_VAL = 1;
COMMIT;


--CASA
INSERT INTO {TBL_NM}
SELECT  CUSTOMER_CDE, 'PRODUCT_SPLIT' FTR_NM, 'CASA' FTR_VAL , TO_CHAR(TO_DATE('{RPT_DT}','DD-MM-YY'), 'DD-MM-YYYY') AS RPT_DT, CURRENT_TIMESTAMP ADD_TSTP FROM
{TBL_NM} 
WHERE FTR_NM = 'CASA_HOLD' AND FTR_VAL = 1;
COMMIT;